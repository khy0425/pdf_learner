<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="PDF Learner - AI-powered PDF learning platform">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- CORS 및 Content-Security-Policy 설정 -->
  <meta http-equiv="Content-Security-Policy" content="default-src * self blob: data: gap:; style-src * self 'unsafe-inline' blob: data: gap:; script-src * 'self' 'unsafe-eval' 'unsafe-inline' blob: data: gap:; object-src * 'self' blob: data: gap:; img-src * self 'unsafe-inline' blob: data: gap:; connect-src self * 'unsafe-inline' blob: data: gap:; frame-src * self blob: data: gap:;">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="PDF Learner">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Google Sign-In Client ID -->
  <meta name="google-signin-client_id" content="189136888100-95h90r9vdrpkdf4og4j92no23spp0mq4.apps.googleusercontent.com">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>PDF Learner</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // JavaScript 인터페이스 설정
    window.PromiseJsImpl = Promise;
    window.handleThenable = function(promise) {
      return Promise.resolve(promise);
    };
    window.jsify = function(obj) {
      if (obj === null || obj === undefined) return obj;
      if (Array.isArray(obj)) {
        return obj.map(window.jsify);
      }
      if (typeof obj === 'object') {
        const result = {};
        for (const key in obj) {
          result[key] = window.jsify(obj[key]);
        }
        return result;
      }
      return obj;
    };
    window.dartify = function(obj) {
      if (obj === null || obj === undefined) return obj;
      if (Array.isArray(obj)) {
        return obj.map(window.dartify);
      }
      if (typeof obj === 'object') {
        const result = {};
        for (const key in obj) {
          result[key] = window.dartify(obj[key]);
        }
        return result;
      }
      return obj;
    };

    // JavaScript 내장 객체 및 함수 설정
    window.js = {
      Promise: Promise,
      Object: Object,
      Array: Array,
      Function: Function,
      String: String,
      Number: Number,
      Boolean: Boolean,
      Date: Date,
      RegExp: RegExp,
      Error: Error,
      Map: Map,
      Set: Set,
      Symbol: Symbol,
      parseInt: parseInt,
      parseFloat: parseFloat,
      isNaN: isNaN,
      isFinite: isFinite,
      decodeURI: decodeURI,
      decodeURIComponent: decodeURIComponent,
      encodeURI: encodeURI,
      encodeURIComponent: encodeURIComponent,
      escape: escape,
      unescape: unescape
    };

    // Firebase 인터페이스 설정
    window.core_interop = {
      jsify: window.jsify,
      dartify: window.dartify
    };

    // PDF.js 설정
    window.pdfjsLib = {
      GlobalWorkerOptions: {
        workerSrc: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'
      }
    };

    // Promise 관련 유틸리티 함수
    window.promiseUtils = {
      resolve: function(value) {
        return Promise.resolve(value);
      },
      reject: function(error) {
        return Promise.reject(error);
      },
      toFuture: function(promise) {
        return Promise.resolve(promise);
      }
    };

    const serviceWorkerVersion = null;
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('flutter_service_worker.js?v=' + serviceWorkerVersion);
    }
  </script>
  
  <!-- PDF.js 스크립트 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>
  
  <!-- Flutter 웹 초기화 -->
  <script src="flutter.js" defer></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-crashlytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-performance-compat.js"></script>

  <style>
    /* PDF 뷰어 관련 스타일 */
    .pdf-container {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 10;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10;
    }
    
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    
    #flutter-target {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="flutter-target"></div>
  
  <script>
    window.addEventListener('load', function(ev) {
      // Flutter 웹 엔트리포인트 로드
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          engineInitializer.initializeEngine().then(function(appRunner) {
            appRunner.runApp();
          });
        }
      });
    });
  </script>
</body>
</html>
